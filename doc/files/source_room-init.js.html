<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>source/room-init.js - skylinkjs</title>
    <link rel="shortcut icon" type="image/ico" href="../assets/favicon.ico">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700|Source+Sans+Pro" type="text/css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700|Source+Code+Pro" type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <style>
      body {
        font-family: 'Source Sans Pro', sans-serif, helvetica;
      }
      pre, code {
        font-family: 'Source Code Pro', consolas, helvetica, sans-serif;
      }
      /* Bootstrap override */
      h1, h2, h3 {
        font-weight: 300;
      }
      h1 span,
      h2 span,
      h3 span {
        font-size: 28px;
        color: #888;
      }
      h1 small,
      h2 small,
      h3 small {
        display: block;
        font-size: 14px;
        margin-top: 10px;
      }
      .badge {
        margin-top: -5px;
        margin-left: 5px;
        font-weight: normal;
      }
      h3 code {
        background: transparent;
        padding: 0;
      }
      .navbar-brand {
        color: #888!important;
        font-weight: bold;
      }
      .navbar-brand small {
        font-size: 12px;
        text-transform: uppercase;
        font-weight: 300;
        margin-left: 15px;
        color: #fff!important;
      }
      .navbar-brand img {
        width: 90px;
        margin-top: -5px;
      }
      .jumbotron hr {
        border-top-color: #888;
      }
      .list-group {
        border-radius: 0!important;
        -webkit-box-shadow: none;
        box-shadow: none;
      }
      .list-group .list-group-item {
        border: 0;
        border-radius: 0!important;
        margin-bottom: 10px;
        padding: 1px 7px;
      }
      .list-group .list-group-item span.settings {
        display: block;
        margin-top: 5px;
      }
      .section-doc-group .col-md-3 {
        padding-left: 0;
      }
      .section-doc-group .col-md-9 {
        padding-right: 0;
        padding-left: 55px;
      }
      .list-group .list-group-item.active {
        color: #428bca;
        text-shadow: none;
        background: transparent;
        border-left: solid 4px #428bca;
      }
      .list-group h4 {
        margin: 0;
      }
      .no-padding {
        padding: 0;
      }
      .code-item-name {
        margin-top: 0;
      }
      .prettyprint {
        border: double 2px #ccc!important; /* override */
        margin-top: 15px;
        border-radius: 0;
        border-left: 0!important;
        border-right: 0!important;
      }
      /* documentation styling */
      .private-method-item,
      .private-event-item,
      .private-property-item,
      .private-attr-item {
        display: none;
      }
      .list-group-o-wrapper {
        background: #fff;
      }
      .list-group-o-wrapper span.title {
        font-size: 22px;
        font-weight: 300;
        margin: 15px;
        display: none;
      }
      .list-group-wrapper {
        overflow-y: auto;
      }
      .property-item,
      .event-item,
      .attr-item {
        display: none;
      }
      /* to always show the constructor */
      .constructor-item .method-item {
        display: block!important;
      }
      .code-item {
        min-height: 0;
      }
      .code-item h4 {
        font-size: 15px;
        text-transform: uppercase;
      }
      .code-item-trigger a {
        font-weight: normal;
        margin-right: 15px;
      }
      .code-item-properties {
        margin: 15px 0;
        padding: 5px 0;
        border: solid 1px #eee;
        border-left: 0;
        border-right: 0;
      }
      .code-item-properties .label {
        font-weight: normal;
        text-transform: uppercase;
      }
      .code-item-properties small {
        display: block;
        margin: 5px 0;
      }
      .code-item-properties .badge {
        background: #aaa;
      }
      .code-item-information {
        margin: 15px 0;
        padding: 2px 7px;
        border-left: solid 4px #f0f0f8;
      }
      .code-item-information span {
        display: block;
        margin: 5px 0;
      }
      .code-item-section {
        margin: 35px 0 45px;
      }
      .code-item-type i {
        font-style: normal;
        text-transform: uppercase;
        margin-right: 15px;
      }
      .params-list .param {
        margin-bottom: 7px;
      }
      .params-list .param .type {
        margin-left: 10px;
        color: #888;
        font-size: 12px;
      }
      .params-list .param .label {
        font-size: 10px;
        /*font-weight: normal;*/
        text-transform: uppercase;
        margin-left: 5px;
        opacity: 0.85;
        background: #eee;
        color: #888;
      }
      .params-list .param .label.multiple {
        background: #f0ad4e;
        color: #fff;
      }
      .returns-description span,
      .returns-description p {
        display: inline-block;
      }
      .returns-description .type {
        margin-right: 15px;
      }
      .checkbox-selected-highlight {
        padding: 2px 7px;
        border: solid 1px #eee;
        border-left: 0;
        border-right: 0;
        background: #fafafa;
      }
      @media (max-width: 991px) {
        .section-doc-group .col-md-3 {
          display: none;
        }
        .section-doc-group .col-md-9 {
          padding-left: 0;
        }
      }
    </style>
    <script>
      var displayPrivateMode = false;
      $(document).ready(function () {
        // seperate every arguments seperator
        $('.args').each(function () {
          var length = $(this).find('.seperator').length;
          // remove the last item
          $(this).find('.seperator')[length - 1].remove();
        });
        // seperate every code-item-trigger
        $('.code-item-trigger').each(function () {
          var content = $(this).html().split(',');
          var outputContent = '';
          for (var i = 0; i < content.length; i++) {
            outputContent += '<a href="#event_' + content[i] + '" class="label label-primary">' + content[i] + '</a>';
          }
          $(this).html(outputContent);
        });
        // set the current window tab
        setSelectedTab($('.doc-selected.active').find('a').attr('href').split('#')[1]);
        // remove unwanted code information
        $('.code-item-information').each(function () {
          if ($(this).find('span').length === 0) {
            $(this).hide();
          }
        });
        // set the private option
        $('#doc-private-select').change(function () {
          displayPrivateMode = $(this).is(':checked');
          setSelectedTab(window.location.hash.split('#')[1]);
        });
      });
      // check the select doc item
      function setSelectedTab (currentSelectedTab) {
        $('.code-item').hide();
        $('.code-menu-item').hide();
        $('.code-item.private').hide();
        $('.code-menu-item.private').hide();

        console.info(currentSelectedTab, currentSelectedTab.indexOf('method') === 0);

        if (currentSelectedTab === 'events' || currentSelectedTab.indexOf('event_') === 0) {
          if (displayPrivateMode) {
            $('.private-event-item').fadeIn().css('display', 'block');
          } else {
            $('.event-item').fadeIn().css('display', 'block');
          }
        } else if (currentSelectedTab === 'methods' || currentSelectedTab.indexOf('method_') === 0) {
          if (displayPrivateMode) {
            $('.private-method-item').fadeIn().css('display', 'block');
          } else {
            $('.method-item').fadeIn().css('display', 'block');
          }
        } else if (currentSelectedTab === 'properties' || currentSelectedTab.indexOf('property_') === 0) {
          if (displayPrivateMode) {
            $('.private-property-item').fadeIn().css('display', 'block');
          } else {
            $('.property-item').fadeIn().css('display', 'block');
          }
        } else if (currentSelectedTab === 'attrs' || currentSelectedTab.indexOf('attr_') === 0) {
          if (displayPrivateMode) {
            $('.private-attr-item').fadeIn().css('display', 'block');
          } else {
            $('.attr-item').fadeIn().css('display', 'block');
          }
        } else {
          $('.code-item').hide();
          $('.code-menu-item').hide();
          $('.code-item.private').hide();
          $('.code-menu-item.private').hide();
        }
      };

      // on click change active selected
      $(window).on('hashchange', function(e){
        // switch tabs
        $('.doc-selected.active').removeClass('active');
        var mainMenus = ['#events', '#properties', '#methods', '#attrs'];
        var menuItems = {
          '#method': '#methods',
          '#event': '#events',
          '#attr': '#attrs',
          '#property': '#properties'
        };
        var typeOfMenuItem = mainMenus.indexOf(window.location.hash);
        // check if parent menu item selected or child menu item
        if (typeOfMenuItem === -1) {
          typeOfMenuItem = mainMenus.indexOf(menuItems[window.location.hash.split('_')[0]]);
        }
        var item = $('.doc-selected a[href="' + mainMenus[typeOfMenuItem] + '"]');
        $(item).parent('.doc-selected').addClass('active');
        console.info(item);
        $('.list-group-o-wrapper .title').html($(item).html());
        $('#current-doc-selected-title').html($(item).html());
        $('.doc-private-label').html($(item).html());
        setSelectedTab($(item).attr('href').split('#')[1]);
      });

      $(window).bind('scroll', function() {
        var scrollTop = $(this).scrollTop();
        if(($('#current-doc-selected-title').offset().top) > scrollTop) {
          // remove the scrollbar top
          $('.list-group-o-wrapper').css('position', '');
          $('.list-group-o-wrapper').css('top', '');
          $('.list-group-o-wrapper').find('.list-group-wrapper').css('min-height', '');
          $('.list-group-o-wrapper').find('.list-group-wrapper').css('height', '');
          $('.list-group-o-wrapper .title').hide().css('display', 'none');
        } else {
          // set scrollbar to top
          $('.list-group-o-wrapper').css('position', 'fixed');
          $('.list-group-o-wrapper').css('top', '65px');
          $('.list-group-o-wrapper').find('.list-group-wrapper').css('min-height', ($(window).height() - 125) + 'px');
          $('.list-group-o-wrapper').find('.list-group-wrapper').css('height', ($(window).height() - 125) + 'px');
          $('.list-group-o-wrapper .title').show().css('display', 'block');
          // set the selected item
          $('.doc-content .code-item').each(function () {
            if ($(this).is(':visible')) {
              var topDistance = $(this).offset().top;
              if((topDistance + $(this).height() - 55) > (scrollTop)) {
                $('.code-menu-item').removeClass('active');
                $('a[href="#' + $(this).attr('id') + '"]').addClass('active');
                return false;
              }
            }
          });
        }
      });
    </script>
</head>
<body>

<div id="doc">
  <nav id="hd" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="" class="navbar-brand">
          <img src="../assets/img/logo.svg" />JS<small>Version: 0.5.3</small>
        </a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul id="api-list" class="nav navbar-nav navbar-right">
  <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Classes <span class="caret"></span></a>
    <ul class="dropdown-menu" role="menu">
      
        <li><a href="../classes/Skylink.html">Skylink</a></li>
      
    </ul>
  </li>
  <!--<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <span class="caret"></span></a>
    <ul class="dropdown-menu" role="menu">
      <li><a href="#api-modules">View all Modules</a></li>
      
    </ul>
  </li>-->
  <li><a href="https://temasys.github.io">Getting Started</a></li>
</ul>
<!--<form id="api-tabview" class="navbar-form navbar-right" role="form">
  <div id="api-tabview-filter" class="form-group">
    <input type="search" id="api-filter" placeholder="Type to filter APIs">
  </div>
</form>-->
      </div><!--/.navbar-collapse -->
    </div>
  </nav>
  <div id="bd" class="yui3-g">

      <div class="yui3-u-1-4">

      </div>
      <div class="yui3-u-3-4">
              <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>

 options
          <div class="apidocs">
              <div id="docs-main">
                  <div class="content">
                      <h1 class="file-heading">File: source/room-init.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * The list of api server data retrieval state.
 * - These are the states to inform the state of retrieving the
 *   information from the api server required to start the peer
 *   connection or if the browser is eligible to start the peer connection.
 * - This is the first event that would fired, because Skylink would retrieve
 *   information from the api server that is required to start the connection.
 * - Once the state is &lt;u&gt;COMPLETED&lt;/u&gt;, Skylink is ready to start the call.
 * - The states that would occur are:
 * @attribute READY_STATE_CHANGE
 * @type JSON
 * @param {Integer} INIT Skylink has just started. No information are
 *   retrieved yet.
 * @param {Integer} LOADING Skylink is starting the retrieval of the
 *   connection information.
 * @param {Integer} COMPLETED Skylink has completed retrieving the
 *   connection.
 * @param {Integer} ERROR Skylink has occurred an error when
 *   retrieving the connection information.
 * @readOnly
 * @since 0.1.0
 */
Skylink.prototype.READY_STATE_CHANGE = {
  INIT: 0,
  LOADING: 1,
  COMPLETED: 2,
  ERROR: -1
};

/**
 * The list of ready state change errors.
 * - These are the error states from the error object error code.
 * - &lt;b&gt;ROOM_LOCKED&lt;/b&gt; is deprecated in 0.5.2. Please use
 *   {{#crossLink &quot;Skylink/:attr&quot;}}leaveRoom(){{/crossLink}}
 * - The states that would occur are:
 * @attribute READY_STATE_CHANGE_ERROR
 * @type JSON
 * @param {Integer} API_INVALID  Api Key provided does not exist.
 * @param {Integer} API_DOMAIN_NOT_MATCH Api Key used in domain does
 *   not match.
 * @param {Integer} API_CORS_DOMAIN_NOT_MATCH Api Key used in CORS
 *   domain does not match.
 * @param {Integer} API_CREDENTIALS_INVALID Api Key credentials does
 *   not exist.
 * @param {Integer} API_CREDENTIALS_NOT_MATCH Api Key credentials does not
 *   match what is expected.
 * @param {Integer} API_INVALID_PARENT_KEY Api Key does not have a parent
 *   key nor is a root key.
 * @param {Integer} API_NOT_ENOUGH_CREDIT Api Key does not have enough
 *   credits to use.
 * @param {Integer} API_NOT_ENOUGH_PREPAID_CREDIT Api Key does not have
 *   enough prepaid credits to use.
 * @param {Integer} API_FAILED_FINDING_PREPAID_CREDIT Api Key preapid
 *   payments does not exist.
 * @param {Integer} API_NO_MEETING_RECORD_FOUND Api Key does not have a
 *   meeting record at this timing. This occurs when Api Key is a
 *   static one.
 * @param {Integer} ROOM_LOCKED Room is locked.
 * @param {Integer} NO_SOCKET_IO No socket.io dependency is loaded to use.
 * @param {Integer} NO_XMLHTTPREQUEST_SUPPORT Browser does not support
 *   XMLHttpRequest to use.
 * @param {Integer} NO_WEBRTC_SUPPORT Browser does not have WebRTC support.
 * @param {Integer} NO_PATH No path is loaded yet.
 * @param {Integer} INVALID_XMLHTTPREQUEST_STATUS Invalid XMLHttpRequest
 *   when retrieving information.
 * @readOnly
 * @since 0.4.0
 */
Skylink.prototype.READY_STATE_CHANGE_ERROR = {
  API_INVALID: 4001,
  API_DOMAIN_NOT_MATCH: 4002,
  API_CORS_DOMAIN_NOT_MATCH: 4003,
  API_CREDENTIALS_INVALID: 4004,
  API_CREDENTIALS_NOT_MATCH: 4005,
  API_INVALID_PARENT_KEY: 4006,
  API_NOT_ENOUGH_CREDIT: 4007,
  API_NOT_ENOUGH_PREPAID_CREDIT: 4008,
  API_FAILED_FINDING_PREPAID_CREDIT: 4009,
  API_NO_MEETING_RECORD_FOUND: 4010,
  ROOM_LOCKED: 5001,
  NO_SOCKET_IO: 1,
  NO_XMLHTTPREQUEST_SUPPORT: 2,
  NO_WEBRTC_SUPPORT: 3,
  NO_PATH: 4,
  INVALID_XMLHTTPREQUEST_STATUS: 5,
  SCRIPT_ERROR: 6
};

/**
 * The list of available regional servers.
 * - This is for developers to set the nearest region server
 *   for Skylink to connect to for faster connectivity.
 * - The available regional servers are:
 * @attribute REGIONAL_SERVER
 * @type JSON
 * @param {String} APAC1 Asia pacific server 1.
 * @param {String} US1 server 1.
 * @readOnly
 * @since 0.5.0
 */
Skylink.prototype.REGIONAL_SERVER = {
  APAC1: &#x27;sg&#x27;,
  US1: &#x27;us2&#x27;
};

/**
 * The path that user is currently connect to.
 * - NOTE ALEX: check if last char is &#x27;/&#x27;
 * @attribute _path
 * @type String
 * @default _serverPath
 * @final
 * @required
 * @private
 * @since 0.1.0
 */
Skylink.prototype._path = null;

/**
 * The regional server that Skylink connects to.
 * @attribute _serverRegion
 * @type String
 * @private
 * @since 0.5.0
 */
Skylink.prototype._serverRegion = null;

/**
 * The server that user connects to to make
 * api calls to.
 * - The reason why users can input this value is to give
 *   users the chance to connect to any of our beta servers
 *   if available instead of the stable version.
 * @attribute _roomServer
 * @type String
 * @default &#x27;//api.temasys.com.sg&#x27;
 * @private
 * @since 0.5.2
 */
Skylink.prototype._roomServer = &#x27;//api.temasys.com.sg&#x27;;

/**
 * The API Key ID.
 * @attribute _apiKey
 * @type String
 * @private
 * @since 0.3.0
 */
Skylink.prototype._apiKey = null;

/**
 * The default room that the user connects to if no room is provided in
 * {{#crossLink &quot;Skylink/joinRoom:method&quot;}}joinRoom(){{/crossLink}}.
 * @attribute _defaultRoom
 * @type String
 * @private
 * @since 0.3.0
 */
Skylink.prototype._defaultRoom = null;

/**
 * The static room&#x27;s meeting starting date and time.
 * - The value is in ISO formatted string.
 * @attribute _roomStart
 * @type String
 * @private
 * @optional
 * @since 0.3.0
 */
Skylink.prototype._roomStart = null;

/**
 * The static room&#x27;s meeting duration.
 * @attribute _roomDuration
 * @type Integer
 * @private
 * @optional
 * @since 0.3.0
 */
Skylink.prototype._roomDuration = null;

/**
 * The credentials required to set the start date and time
 * and the duration.
 * @attribute _roomCredentials
 * @type String
 * @private
 * @optional
 * @since 0.3.0
 */
Skylink.prototype._roomCredentials = null;

/**
 * The current Skylink ready state change.
 * [Rel: Skylink.READY_STATE_CHANGE]
 * @attribute _readyState
 * @type Integer
 * @private
 * @required
 * @since 0.1.0
 */
Skylink.prototype._readyState = 0;

/**
 * The received server key.
 * @attribute _key
 * @type String
 * @private
 * @since 0.1.0
 */
Skylink.prototype._key = null;

/**
 * The owner&#x27;s username of the apiKey.
 * @attribute _apiKeyOwner
 * @type String
 * @private
 * @since 0.5.2
 */
Skylink.prototype._apiKeyOwner = null;

/**
 * The room connection information.
 * @attribute _room
 * @type JSON
 * @param {String} id The roomId of the room user is connected to.
 * @param {String} token The token of the room user is connected to.
 * @param {String} startDateTime The startDateTime in ISO string format of the room.
 * @param {String} duration The duration of the room.
 * @param {JSON} connection Connection constraints and configuration.
 * @param {JSON} connection.peerConstraints The peerconnection constraints.
 * @param {JSON} connection.peerConfig The peerconnection configuration.
 * @param {JSON} connection.offerConstraints The offer constraints.
 * @param {JSON} connection.sdpConstraints The sdp constraints.
 * @required
 * @private
 * @since 0.5.2
 */
Skylink.prototype._room = null;

/**
 * Gets information from api server.
 * @method _requestServerInfo
 * @param {String} method The http method.
 * @param {String} url The url to do a rest call.
 * @param {Function} callback The callback fired after Skylink
 *   receives a response from the api server.
 * @param {JSON} params HTTP Params
 * @private
 * @since 0.5.2
 */
Skylink.prototype._requestServerInfo = function(method, url, callback, params) {
  var self = this;
  // XDomainRequest is supported in IE8 - 9
  var useXDomainRequest = window.webrtcDetectedBrowser === &#x27;IE&#x27; &amp;&amp;
    (window.webrtcDetectedVersion === 9 || window.webrtcDetectedVersion === 8) &amp;&amp;
    typeof window.XDomainRequest === &#x27;function&#x27;;
  var xhr;

  if (useXDomainRequest) {
    log.debug([null, &#x27;XMLHttpRequest&#x27;, method, &#x27;Using XDomainRequest. &#x27; +
      &#x27;XMLHttpRequest is now XDomainRequest&#x27;], {
      agent: window.webrtcDetectedBrowser,
      version: window.webrtcDetectedVersion
    });
    xhr = new XDomainRequest();
    xhr.setContentType = function (contentType) {
      xhr.contentType = contentType;
    };
  } else {
    log.debug([null, &#x27;XMLHttpRequest&#x27;, method, &#x27;Using XMLHttpRequest&#x27;], {
      agent: window.webrtcDetectedBrowser,
      version: window.webrtcDetectedVersion
    });
    xhr = new window.XMLHttpRequest();
    xhr.setContentType = function (contentType) {
      xhr.setRequestHeader(&#x27;Content-type&#x27;, contentType);
    };
  }

  xhr.onload = function () {
    xhr.response = xhr.responseText || xhr.response;
    xhr.status = xhr.status || 200;
    log.debug([null, &#x27;XMLHttpRequest&#x27;, method, &#x27;Received sessions parameters&#x27;],
      JSON.parse(xhr.response || &#x27;{}&#x27;));
    callback(xhr.status, JSON.parse(xhr.response || &#x27;{}&#x27;));
  };

  xhr.onerror = function () {
    log.error([null, &#x27;XMLHttpRequest&#x27;, method, &#x27;Failed retrieving information:&#x27;],
      { status: xhr.status });
  };

  xhr.onprogress = function () {
    log.debug([null, &#x27;XMLHttpRequest&#x27;, method,
      &#x27;Retrieving information and config from webserver. Url:&#x27;], url);
    log.debug([null, &#x27;XMLHttpRequest&#x27;, method, &#x27;Provided parameters:&#x27;], params);
  };

  xhr.open(method, url, true);
  if (params) {
    xhr.setContentType(&#x27;application/json;charset=UTF-8&#x27;);
    xhr.send(JSON.stringify(params));
  } else {
    xhr.send();
  }
};

/**
 * Parse the information received from the api server.
 * @method _parseInfo
 * @param {JSON} info The parsed information from the server.
 * @trigger readyStateChange
 * @private
 * @required
 * @since 0.5.2
 */
Skylink.prototype._parseInfo = function(info) {
  log.log(&#x27;Parsing parameter from server&#x27;, info);
  if (!info.pc_constraints &amp;&amp; !info.offer_constraints) {
    this._trigger(&#x27;readyStateChange&#x27;, this.READY_STATE_CHANGE.ERROR, {
      status: 200,
      content: info.info,
      errorCode: info.error
    });
    return;
  }

  log.debug(&#x27;Peer connection constraints:&#x27;, info.pc_constraints);
  log.debug(&#x27;Offer constraints:&#x27;, info.offer_constraints);

  this._key = info.cid;
  this._apiKeyOwner = info.apiOwner;
  this._signalingServer = info.ipSigserver;
  this._user = {
    uid: info.username,
    token: info.userCred,
    timeStamp: info.timeStamp,
    streams: [],
    info: {}
  };
  this._room = {
    id: info.room_key,
    token: info.roomCred,
    startDateTime: info.start,
    duration: info.len,
    connection: {
      peerConstraints: JSON.parse(info.pc_constraints),
      peerConfig: null,
      offerConstraints: JSON.parse(info.offer_constraints),
      sdpConstraints: {
        mandatory: {
          OfferToReceiveAudio: true,
          OfferToReceiveVideo: true
        }
      },
      mediaConstraints: JSON.parse(info.media_constraints)
    }
  };
  // use default bandwidth and media resolution provided by server
  this._streamSettings.bandwidth = info.bandwidth;
  this._readyState = 2;
  this._trigger(&#x27;readyStateChange&#x27;, this.READY_STATE_CHANGE.COMPLETED);
  log.info(&#x27;Parsed parameters from webserver. &#x27; +
    &#x27;Ready for web-realtime communication&#x27;);
};

/**
 * Start the loading of information from the api server.
 * @method _loadInfo
 * @trigger readyStateChange
 * @private
 * @required
 * @since 0.5.2
 */
Skylink.prototype._loadInfo = function() {
  var self = this;
  if (!window.io) {
    log.error(&#x27;Socket.io not loaded. Please load socket.io&#x27;);
    self._trigger(&#x27;readyStateChange&#x27;, self.READY_STATE_CHANGE.ERROR, {
      status: null,
      content: &#x27;Socket.io not found&#x27;,
      errorCode: self.READY_STATE_CHANGE_ERROR.NO_SOCKET_IO
    });
    return;
  }
  if (!window.XMLHttpRequest) {
    log.error(&#x27;XMLHttpRequest not supported. Please upgrade your browser&#x27;);
    self._trigger(&#x27;readyStateChange&#x27;, self.READY_STATE_CHANGE.ERROR, {
      status: null,
      content: &#x27;XMLHttpRequest not available&#x27;,
      errorCode: self.READY_STATE_CHANGE_ERROR.NO_XMLHTTPREQUEST_SUPPORT
    });
    return;
  }
  if (!window.RTCPeerConnection) {
    log.error(&#x27;WebRTC not supported. Please upgrade your browser&#x27;);
    self._trigger(&#x27;readyStateChange&#x27;, self.READY_STATE_CHANGE.ERROR, {
      status: null,
      content: &#x27;WebRTC not available&#x27;,
      errorCode: self.READY_STATE_CHANGE_ERROR.NO_WEBRTC_SUPPORT
    });
    return;
  }
  if (!self._path) {
    log.error(&#x27;Skylink is not initialised. Please call init() first&#x27;);
    self._trigger(&#x27;readyStateChange&#x27;, self.READY_STATE_CHANGE.ERROR, {
      status: null,
      content: &#x27;No API Path is found&#x27;,
      errorCode: self.READY_STATE_CHANGE_ERROR.NO_PATH
    });
    return;
  }
  self._readyState = 1;
  self._trigger(&#x27;readyStateChange&#x27;, self.READY_STATE_CHANGE.LOADING);
  self._requestServerInfo(&#x27;GET&#x27;, self._path, function(status, response) {
    if (status !== 200) {
      // 403 - Room is locked
      // 401 - API Not authorized
      // 402 - run out of credits
      var errorMessage = &#x27;XMLHttpRequest status not OK\nStatus was: &#x27; + status;
      self._readyState = 0;
      self._trigger(&#x27;readyStateChange&#x27;, self.READY_STATE_CHANGE.ERROR, {
        status: status,
        content: (response) ? (response.info || errorMessage) : errorMessage,
        errorCode: response.error ||
          self.READY_STATE_CHANGE_ERROR.INVALID_XMLHTTPREQUEST_STATUS
      });
      return;
    }
    self._parseInfo(response);
  });
};

/**
 * Initialize Skylink to retrieve new connection information bbasd on options.
 * @method _initSelectedRoom
 * @param {String} room The room to connect to.
 * @param {Function} callback The callback fired once Skylink is re-initialized.
 * @trigger readyStateChange
 * @private
 * @since 0.5.2
 */
Skylink.prototype._initSelectedRoom = function(room, callback) {
  var self = this;
  if (typeof room === &#x27;function&#x27; || typeof room === &#x27;undefined&#x27;) {
    log.error(&#x27;Invalid room provided. Room:&#x27;, room);
    return;
  }
  var defaultRoom = self._defaultRoom;
  var initOptions = {
    roomServer: self._roomServer,
    defaultRoom: room || defaultRoom,
    apiKey: self._apiKey,
    region: self._serverRegion,
    enableDataChannel: self._enableDataChannel,
    enableIceTrickle: self._enableIceTrickle
  };
  if (self._roomCredentials) {
    initOptions.credentials = {
      credentials: self._roomCredentials,
      duration: self._roomDuration,
      startDateTime: self._roomStart
    };
  }
  self.init(initOptions);
  self._defaultRoom = defaultRoom;
  var checkReadyState = setInterval(function () {
    if (self._readyState === self.READY_STATE_CHANGE.COMPLETED) {
      clearInterval(checkReadyState);
      callback();
    }
  }, 100);
};

/**
 * Intiailize Skylink to retrieve connection information.
 * - &lt;b&gt;&lt;i&gt;IMPORTANT&lt;/i&gt;&lt;/b&gt;: Please call this method to load all server
 *   information before joining the room or doing anything else.
 * - If you would like to set the start time and duration of the room,
 *   you have to generate the credentials. In example 3, we use the
 *    [CryptoJS](https://code.google.com/p/crypto-js/) library.
 *   - Step 1: Generate the hash. It is created by using the roomname,
 *     duration and the timestamp (in ISO String format).
 *   - Step 2: Generate the Credentials. It is is generated by converting
 *     the hash to a Base64 string and then encoding it to a URI string.
 *   - Step 3: Initialize Skylink
 * @method init
 * @param {String|JSON} options Connection options or API Key ID
 * @param {String} options.apiKey API Key ID to identify with the Temasys
 *   backend server
 * @param {String} options.defaultRoom Optional. The default room to connect
 *   to if there is no room provided in
 *   {{#crossLink &quot;Skylink/joinRoom:method&quot;}}joinRoom(){{/crossLink}}.
 * @param {String} options.roomServer Optional. Path to the Temasys
 *   backend server. If there&#x27;s no room provided, default room would be used.
 * @param {String} options.region Optional. The regional server that user
 *   chooses to use. [Rel: Skylink.REGIONAL_SERVER]
 * @param {Boolean} options.enableIceTrickle Optional. The option to enable
 *   ICE trickle or not.
 * - Default is true.
 * @param {Boolean} options.enableDataChannel Optional. The option to enable
 *   enableDataChannel or not.
 * - Default is true.
 * @param {Boolean} options.enableTURNServer To enable TURN servers in ice connection.
 *   Please do so at your own risk as it might disrupt the connection.
 * - Default is true.
 * @param {Boolean} options.enableSTUNServer To enable STUN servers in ice connection.
 *   Please do so at your own risk as it might disrupt the connection.
 * - Default is true.
 * @param {Boolean} options.TURNServerTransport To set the transport packet type.
 *  [Rel: Skylink.TURN_TRANSPORT]
 * - Default is Skylink.TURN_TRANSPORT.ANY
 * @param {JSON} options.credentials Optional. Credentials options for
 *   setting a static meeting.
 * @param {String} options.credentials.startDateTime The start timing of the
 *   meeting in Date ISO String
 * @param {Integer} options.credentials.duration The duration of the meeting
 * @param {String} options.credentials.credentials The credentials required
 *   to set the timing and duration of a meeting.
 * @param {Boolean} options.audioFallback To allow the option to fallback to
 *   audio if failed retrieving video stream.
 * @example
 *   // Note: Default room is apiKey when no room
 *   // Example 1: To initalize without setting any default room.
 *   SkylinkDemo.init(&#x27;apiKey&#x27;);
 *
 *   // Example 2: To initialize with apikey, roomServer and defaultRoom
 *   SkylinkDemo.init({
 *     &#x27;apiKey&#x27; : &#x27;apiKey&#x27;,
 *     &#x27;roomServer&#x27; : &#x27;http://xxxx.com&#x27;,
 *     &#x27;defaultRoom&#x27; : &#x27;mainHangout&#x27;
 *   });
 *
 *   // Example 3: To initialize with credentials to set startDateTime and
 *   // duration of the room
 *   var hash = CryptoJS.HmacSHA1(roomname + &#x27;_&#x27; + duration + &#x27;_&#x27; +
 *     (new Date()).toISOString(), token);
 *   var credentials = encodeURIComponent(hash.toString(CryptoJS.enc.Base64));
 *   SkylinkDemo.init({
 *     &#x27;apiKey&#x27; : &#x27;apiKey&#x27;,
 *     &#x27;roomServer&#x27; : &#x27;http://xxxx.com&#x27;,
 *     &#x27;defaultRoom&#x27; : &#x27;mainHangout&#x27;
 *     &#x27;credentials&#x27; : {
 *        &#x27;startDateTime&#x27; : (new Date()).toISOString(),
 *        &#x27;duration&#x27; : 500,
 *        &#x27;credentials&#x27; : credentials
 *     }
 *   });
 * @trigger readyStateChange
 * @for Skylink
 * @required
 * @since 0.5.3
 */
Skylink.prototype.init = function(options) {
  if (!options) {
    log.error(&#x27;No API key provided&#x27;);
    return;
  }
  var apiKey, room, defaultRoom, region;
  var startDateTime, duration, credentials;
  var roomServer = this._roomServer;
  var enableIceTrickle = true;
  var enableDataChannel = true;
  var enableSTUNServer = true;
  var enableTURNServer = true;
  var TURNTransport = this.TURN_TRANSPORT.ANY;
  var audioFallback = false;

  log.log(&#x27;Provided init options:&#x27;, options);

  if (typeof options === &#x27;string&#x27;) {
    // set all the default api key, default room and room
    apiKey = options;
    defaultRoom = apiKey;
    room = apiKey;
  } else {
    // set the api key
    apiKey = options.apiKey;
    // set the room server
    roomServer = options.roomServer || roomServer;
    // check room server if it ends with /. Remove the extra /
    roomServer = (roomServer.lastIndexOf(&#x27;/&#x27;) ===
      (roomServer.length - 1)) ? roomServer.substring(0,
      roomServer.length - 1) : roomServer;
    // set the region
    region = options.region || region;
    // set the default room
    defaultRoom = options.defaultRoom || apiKey;
    // set the selected room
    room = defaultRoom;
    // set ice trickle option
    enableIceTrickle = (typeof options.enableIceTrickle === &#x27;boolean&#x27;) ?
      options.enableIceTrickle : enableIceTrickle;
    // set data channel option
    enableDataChannel = (typeof options.enableDataChannel === &#x27;boolean&#x27;) ?
      options.enableDataChannel : enableDataChannel;
    // set stun server option
    enableSTUNServer = (typeof options.enableSTUNServer === &#x27;boolean&#x27;) ?
      options.enableSTUNServer : enableSTUNServer;
    // set turn server option
    enableTURNServer = (typeof options.enableTURNServer === &#x27;boolean&#x27;) ?
      options.enableTURNServer : enableTURNServer;
    // set turn transport option
    if (typeof options.TURNServerTransport === &#x27;string&#x27;) {
      // loop out for every transport option
      for (var type in this.TURN_TRANSPORT) {
        if (this.TURN_TRANSPORT.hasOwnProperty(type)) {
          // do a check if the transport option is valid
          if (this.TURN_TRANSPORT[type] === options.TURNServerTransport) {
            TURNTransport = options.TURNServerTransport;
            break;
          }
        }
      }
    }
    // set audio fallback option
    audioFallback = options.audioFallback || audioFallback;
    // Custom default meeting timing and duration
    // Fallback to default if no duration or startDateTime provided
    if (options.credentials) {
      // set start data time
      startDateTime = options.credentials.startDateTime ||
        (new Date()).toISOString();
      // set the duration
      duration = options.credentials.duration || 200;
      // set the credentials
      credentials = options.credentials.credentials;
    }
  }
  // api key path options
  this._apiKey = apiKey;
  this._roomServer = roomServer;
  this._defaultRoom = defaultRoom;
  this._selectedRoom = room;
  this._serverRegion = region;
  this._path = roomServer + &#x27;/api/&#x27; + apiKey + &#x27;/&#x27; + room;
  // set credentials if there is
  if (credentials) {
    this._roomStart = startDateTime;
    this._roomDuration = duration;
    this._roomCredentials = credentials;
    this._path += (credentials) ? (&#x27;/&#x27; + startDateTime + &#x27;/&#x27; +
      duration + &#x27;?&amp;cred=&#x27; + credentials) : &#x27;&#x27;;
  }
  // check if there is a other query parameters or not
  if (region) {
    this._path += ((this._path.indexOf(&#x27;?&amp;&#x27;) &gt; -1) ?
      &#x27;&amp;&#x27; : &#x27;?&amp;&#x27;) + &#x27;rg=&#x27; + region;
  }
  // skylink functionality options
  this._enableIceTrickle = enableIceTrickle;
  this._enableDataChannel = enableDataChannel;
  this._enableSTUN = enableSTUNServer;
  this._enableTURN = enableTURNServer;
  this._TURNTransport = TURNTransport;
  this._audioFallback = audioFallback;

  log.log(&#x27;Init configuration:&#x27;, {
    serverUrl: this._path,
    readyState: this._readyState,
    apiKey: this._apiKey,
    roomServer: this._roomServer,
    defaultRoom: this._defaultRoom,
    selectedRoom: this._selectedRoom,
    serverRegion: this._serverRegion,
    enableDataChannel: this._enableDataChannel,
    enableIceTrickle: this._enableIceTrickle,
    enableTURNServer: this._enableTURN,
    enableSTUNServer: this._enableSTUN,
    TURNTransport: this._TURNTransport,
    audioFallback: this._audioFallback
  });
  // trigger the readystate
  this._readyState = 0;
  this._trigger(&#x27;readyStateChange&#x27;, this.READY_STATE_CHANGE.INIT);
  this._loadInfo();
};
    </pre>
</div>

                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
